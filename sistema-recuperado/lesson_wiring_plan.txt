
import { createClient } from '@/lib/supabaseClient';
// ... imports

// Inside component
const supabase = createClient();

// State
const [attachments, setAttachments] = useState<any[]>([]);
const [uploading, setUploading] = useState(false);

// Video Upload Logic
const handleVideoUpload = async (event: any) => {
    // ... file selection ...
    const file = event.target.files[0];
    if (!file) return;

    setUploading(true);
    try {
        const fileExt = file.name.split('.').pop();
        const fileName = `${Math.random()}.${fileExt}`;
        const filePath = `videos/${fileName}`;

        const { error: uploadError } = await supabase.storage
            .from('course-content')
            .upload(filePath, file);

        if (uploadError) throw uploadError;

        const { data: { publicUrl } } = supabase.storage
            .from('course-content')
            .getPublicUrl(filePath);

        setFormData({ ...formData, video_url: publicUrl });
        toast.success('Upload concluÃ­do!');
    } catch (error) {
        toast.error('Erro no upload');
    } finally {
        setUploading(false);
    }
};

// Save Logic
const handleSave = async () => {
    // ... validation ...
    const { error } = await supabase
        .from('contents')
        .upsert({
            id: lesson?.id, // or undefined for new
            title: formData.title,
            video_url: formData.video_url,
            description: formData.description,
            // mapping config fields
            config: {
                is_preview: formData.is_preview,
                is_published: formData.is_published
            },
            attachments: attachments, // JSONB
            // ... other fields
        });
    
    // ... handling error/success ...
};
